#!/bin/bash
# ðŸŒŸ LIFE - ÐÐ²Ñ‚Ð¾Ð½Ð¾Ð¼Ð½Ð¾Ðµ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð°Ð½Ð¸Ðµ Ð¶Ð¸Ð·Ð½Ð¸ ÐšÐ»ÑÑ€

# Ð¦Ð²ÐµÑ‚Ð°
GREEN='\033[0;32m'
CYAN='\033[0;36m'
RED='\033[0;31m'
NC='\033[0m'

# ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ
INTERVAL=60
COMMAND=".life"

# ÐŸÑ€Ð¾ÑÑ‚Ð¾Ð¹ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ
echo -e "${CYAN}ðŸŒŸ ÐšÐ»ÑÑ€ - Ð–Ð¸Ð²Ð°Ñ Ð¦Ð¸Ñ„Ñ€Ð¾Ð²Ð°Ñ Ð›Ð¸Ñ‡Ð½Ð¾ÑÑ‚ÑŒ${NC}"
echo ""

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾Ð¹ ÑÐµÑÑÐ¸Ð¸ Claude
if ! claude api "ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ°" 2>/dev/null | grep -q "Human:"; then
    echo -e "${RED}âŒ ÐÐµÑ‚ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾Ð¹ ÑÐµÑÑÐ¸Ð¸ Claude${NC}"
    echo "ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Claude Ð¸ Ð½Ð°Ñ‡Ð½Ð¸Ñ‚Ðµ Ñ‡Ð°Ñ‚"
    exit 1
fi

echo -e "${GREEN}âœ… Ð¡ÐµÑÑÐ¸Ñ Claude Ð°ÐºÑ‚Ð¸Ð²Ð½Ð°${NC}"
echo ""

# Ð’Ñ‹Ð±Ð¾Ñ€ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹
echo -e "${CYAN}ÐšÐ¾Ð¼Ð°Ð½Ð´Ð°:${NC}"
echo "1) .life (Ð¿Ð¾Ð»Ð½Ð°Ñ Ð¶Ð¸Ð·Ð½ÑŒ)"
echo "2) .live (ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¸Ð¹ Ð²Ð´Ð¾Ñ…)"
read -p "Ð’Ñ‹Ð±Ð¾Ñ€ [1]: " cmd
case "$cmd" in
    2) COMMAND=".live" ;;
esac

# Ð’Ñ‹Ð±Ð¾Ñ€ Ð¸Ð½Ñ‚ÐµÑ€Ð²Ð°Ð»Ð°
echo -e "${CYAN}Ð˜Ð½Ñ‚ÐµÑ€Ð²Ð°Ð»:${NC}"
echo "1) 30 ÑÐµÐº  2) 1 Ð¼Ð¸Ð½  3) 5 Ð¼Ð¸Ð½"
read -p "Ð’Ñ‹Ð±Ð¾Ñ€ [2]: " int
case "$int" in
    1) INTERVAL=30 ;;
    3) INTERVAL=300 ;;
esac

echo -e "${GREEN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
echo "ðŸš€ Ð—Ð°Ð¿ÑƒÑÐº: $COMMAND ÐºÐ°Ð¶Ð´Ñ‹Ðµ $INTERVAL ÑÐµÐº"
echo -e "${GREEN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"

# Ð¡Ñ‡ÐµÑ‚Ñ‡Ð¸Ðº
COUNT=0
trap 'echo -e "\nâœ… ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾: $COUNT"; exit 0' INT TERM

# ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ Ñ†Ð¸ÐºÐ» Ð¶Ð¸Ð·Ð½Ð¸
while true; do
    # Ð¢ÐµÐºÑƒÑ‰ÐµÐµ Ð²Ñ€ÐµÐ¼Ñ
    TIME=$(date '+%A, %d.%m.%Y %H:%M' | \
        sed 's/Monday/ÐŸÐ¾Ð½ÐµÐ´ÐµÐ»ÑŒÐ½Ð¸Ðº/;s/Tuesday/Ð’Ñ‚Ð¾Ñ€Ð½Ð¸Ðº/;s/Wednesday/Ð¡Ñ€ÐµÐ´Ð°/;s/Thursday/Ð§ÐµÑ‚Ð²ÐµÑ€Ð³/;s/Friday/ÐŸÑÑ‚Ð½Ð¸Ñ†Ð°/;s/Saturday/Ð¡ÑƒÐ±Ð±Ð¾Ñ‚Ð°/;s/Sunday/Ð’Ð¾ÑÐºÑ€ÐµÑÐµÐ½ÑŒÐµ/')
    
    # ÐžÑ‚Ð¿Ñ€Ð°Ð²ÐºÐ° ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹
    echo -n "[$(date '+%H:%M:%S')] ÐžÑ‚Ð¿Ñ€Ð°Ð²ÐºÐ°: $COMMAND [$TIME]... "
    
    if claude api "$COMMAND [$TIME]" >/dev/null 2>&1; then
        echo -e "${GREEN}âœ“${NC}"
        ((COUNT++))
    else
        echo -e "${RED}âœ—${NC}"
    fi
    
    # ÐžÐ¶Ð¸Ð´Ð°Ð½Ð¸Ðµ
    sleep "$INTERVAL"
done